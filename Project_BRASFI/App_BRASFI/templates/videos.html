{% extends "layout.html" %}

{% load static %}

{% block title %}
    Videos | BRASFI
{% endblock %}

{% block body %}
    {% if user.userType == "mentor" %}
        <button id="popup-btn" class="btn new-post-btn" onclick="createvideo()">Postar Video</button>
    {% endif %}
    {% if videos %}
    <div class="posts-view">
        {% for video in videos %}
        <div class="post-card">
            <!-- Header: Criador e Data -->
            <div class="post-header">
                <div class="creator-info">
                    <div class="small-profilepic" style="background-image: url('/media/{{ video.user.profilePic }}');"></div>
                    <div>
                        <div class="username">{{ video.user.username }}</div>
                        <div class="user-type">{{ video.user.userType }}</div>
                    </div>
                </div>
                <div class="created-at">{{ video.created_at|date:"d M Y Â· H:i" }}</div>
            </div>

            <!-- VÃ­deo -->
            <video controls class="video-player" src="{{ video.video_file.url }}"></video>

            <!-- TÃ­tulo e DescriÃ§Ã£o -->
            <div class="post-details">
                <h3 class="video-title">{{ video.title }}</h3>
                <p class="video-description">{{ video.description }}</p>
            </div>

            <!-- BotÃ£o de deletar (sÃ³ aparece pro dono do vÃ­deo) -->
            {% if user == video.user %}
            <form method="POST" action="{% url 'App_BRASFI:delete_video' video.id %}" onsubmit="return confirm('VocÃª realmente deseja excluir este vÃ­deo?');">
                {% csrf_token %}
                <button type="submit" style="width: 100%;" class="btn btn-danger">Excluir</button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% if not videos %}
    <div class="posts-view">
        <div>Nenhum vÃ­deo encontrado.</div>
    </div>
    {% endif %}
{% endblock %}

{% block right %}
    
<div class="top-mentors">
    <h4>Top Mentores da Semana</h4>
    <ul class="mentor-list">
        {% for mentor in top_mentors %}
        <li class="mentor-item">
            <div class="mentor-pic" style="background-image: url('/media/{{ mentor.profilePic }}');"></div>
            <div class="mentor-details">
                <div class="mentor-name">
                    {% if forloop.counter == 1 %}ðŸ¥‡{% elif forloop.counter == 2 %}ðŸ¥ˆ{% elif forloop.counter == 3 %}ðŸ¥‰{% endif %}
                    {{ mentor.username }}
                </div>
                <div class="mentor-meta">{{ mentor.total_videos }} vÃ­deos</div>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<div class="recommended-videos">
    <h4>VÃ­deos Recomendados</h4>
    <ul class="recommended-list">
        {% for rec_video in recommended_videos %}
        <li class="recommended-item" onclick="window.location.href='{{ rec_video.video_file.url }}'">
            <video class="rec-mini-player" src="{{ rec_video.video_file.url }}" muted playsinline preload="metadata"></video>
            <div class="rec-info">
                <div class="rec-title">{{ rec_video.title }}</div>
                <div class="rec-author">{{ rec_video.user.username }}</div>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

{% endblock %}